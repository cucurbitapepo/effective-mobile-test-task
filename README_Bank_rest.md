# Система управления банковскими картами

---
___Содержание:___
- [Используемый стек и библиотеки](#используемый-стек-и-библиотеки)
- [Деплой и запуск](#деплой-и-запуск)
- [Описание](#описание)
___     

# Используемый стек и библиотеки.
1. **Язык реализации:** Java 17
2. **Фреймворк:** Spring Boot
3. **База данных:**  PostgreSQL 16
4. **версия JDK :** 17
5. **Система сборки:** Maven
6. **Тестирование:** Mockito, AssertJ, MockMVC
7. **Описание документации:** OpenAPI(Swagger)
8. **Миграция СУБД:** Liquibase
___

# Деплой и запуск
- запустить docker-compose (соберёт приложение и базу данных для него)
- для запуска приложения через IDE нужно поменять настройки к БД в application.yaml:
~~~
url: jdbc:postgresql://PostgreSQL:5432/bcsm_db
~~~
заменить на закомментированное
~~~
url: jdbc:postgresql://localhost:5432/bcsm_db
~~~

# Описание
- Сервис поднимается на порте 9009, соответственно запросы будут начинаться:
~~~
http://localhost:9009/*
~~~
- Документация Swagger доступна по [ссылке](http://localhost:9009/swagger-ui/index.html)
- сделанное допущение в архитектуре: во время получения токена пользователь дополнительно получает свой id из базы данных. Предполагается, что данный id будет отдаваться фронтом, чтобы в последствии проверять, что пользователь имеет право доступа для переводов и других операций со своими картами. В токен эту информацию решил не зашивать, на случай перехвата. В микросервисной архитектуре такой проблемы не было бы, так как скорее всего id не выходил бы за предела API Gateway.
- При инициализации приложения сразу создаётся 2 пользователя с разными ролями: ***login=misha password=misha*** с ролью пользователя и ***login=admin password=admin*** с ролью администратора.
- Маскирование карт реализовано для пользователя, предполагается что администратор должен видеть полный номер карты.
- Шифрование номера карты реализовано средствами PostgreSQL с помощью встроенного алгоритма pgcrypto.
- Для наполнения базы данных тестовыми картами можно использовать под пользователем **admin**. Естественно сначала получите JWT.
~~~
curl --location 'http://localhost:9009/admin/cards' \
--header 'Content-Type: application/json' \
--header 'Authorization: ••••••' \
--data '{
  "cardNumber": "1234 5678 9012 5564",
  "userId": "c8eb85e0-ed3e-475f-8fdf-6c385e0429fa",
  "expirationDate": "2028-12-31",
  "cardStatus": "ACTIVE",
  "balance": 1000.50
}'
~~~
- Срок жизни JWT - 10 минут